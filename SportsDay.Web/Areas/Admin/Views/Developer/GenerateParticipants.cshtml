@using SportsDay.Lib.Services.Interfaces
@{
    ViewData["Title"] = "Generate Participants";
    var activeTournament = ViewBag.ActiveTournament as SportsDay.Lib.Models.Tournament;
    var stats = ViewBag.Stats as DeveloperStats;
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">
                <i class="bi bi-person-plus text-success me-2"></i>Generate Participants
            </h1>
            <p class="text-muted mt-2">Choose how to generate test participants for the tournament</p>
        </div>
        @if (activeTournament != null)
        {
            <div class="badge bg-success p-2">
                <i class="bi bi-trophy-fill me-2"></i>Active Tournament: @activeTournament.Name
            </div>
        }
    </div>

    <!-- Navigation -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-area="Admin" asp-controller="Developer" asp-action="Index">
                    <i class="bi bi-code-slash me-1"></i>Developer Tools
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Generate Participants</li>
        </ol>
    </nav>

    <!-- Alert Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>@TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Current Statistics -->
    @if (stats != null)
    {
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h3 class="mb-1">@stats.ParticipantCount</h3>
                        <small>Current Participants</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-secondary text-white">
                    <div class="card-body text-center">
                        <h3 class="mb-1">@stats.HouseCount</h3>
                        <small>Houses</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h3 class="mb-1">@stats.EventCount</h3>
                        <small>Events</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <h3 class="mb-1">@stats.ResultCount</h3>
                        <small>Results</small>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Warning Banner -->
    <div class="alert alert-warning mb-4">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>Warning:</strong> These actions will create new participants in the active tournament. 
        Make sure you have the correct tournament activated before proceeding.
    </div>

    <!-- Participant Generation Options -->
    <div class="row g-4">
        <!-- Option 1: 2 Random Participants per House -->
        <div class="col-md-6">
            <div class="card border-success h-100">
                <div class="card-header bg-success text-white">
                    <i class="bi bi-people me-2"></i>Simple Generation
                </div>
                <div class="card-body">
                    <h5 class="card-title">2 Random Participants per House</h5>
                    <p class="card-text text-muted">
                        Generates 2 random participants for each house with:
                    </p>
                    <ul class="list-unstyled mb-4">
                        <li><i class="bi bi-check-circle text-success me-2"></i>Random names and ages (11-20)</li>
                        <li><i class="bi bi-check-circle text-success me-2"></i>Random gender distribution</li>
                        <li><i class="bi bi-check-circle text-success me-2"></i>Age-appropriate class assignment</li>
                        <li><i class="bi bi-check-circle text-success me-2"></i>Total: <strong>@(stats?.HouseCount * 2 ?? 12) participants</strong></li>
                    </ul>
                    
                    <form asp-action="Generate2ParticipantsPerHouse" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-success w-100" 
                                onclick="return confirm('Generate 2 random participants per house?');">
                            <i class="bi bi-person-plus me-2"></i>Generate Simple Participants
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Option 2: Comprehensive Participants -->
        <div class="col-md-6">
            <div class="card border-primary h-100">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-grid-3x3-gap me-2"></i>Comprehensive Generation
                </div>
                <div class="card-body">
                    <h5 class="card-title">Complete Division/Class Coverage</h5>
                    <p class="card-text text-muted">
                        Generates 1 participant from each division (gender) and class combination per house:
                    </p>
                    <ul class="list-unstyled mb-4">
                        <li><i class="bi bi-check-circle text-primary me-2"></i>Boys & Girls divisions</li>
                        <li><i class="bi bi-check-circle text-primary me-2"></i>All classes (Open, Class 1-4)</li>
                        <li><i class="bi bi-check-circle text-primary me-2"></i>Age-appropriate for each class</li>
                        <li><i class="bi bi-check-circle text-primary me-2"></i>Total: <strong>@(stats?.HouseCount * 2 * 5 ?? 60) participants</strong></li>
                    </ul>
                    
                    <div class="alert alert-info mb-3">
                        <small>
                            <i class="bi bi-info-circle me-1"></i>
                            This creates comprehensive coverage for testing all event types and divisions.
                        </small>
                    </div>
                    
                    <form asp-action="GenerateComprehensiveParticipants" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-primary w-100" 
                                onclick="return confirm('Generate comprehensive participants (1 from each division/class combination per house)? This will create @(stats?.HouseCount * 2 * 5 ?? 60) participants.');">
                            <i class="bi bi-grid-3x3-gap me-2"></i>Generate Comprehensive Participants
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Information Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light">
                    <i class="bi bi-info-circle me-2"></i>Generation Details
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Division Types:</h6>
                            <ul class="list-unstyled">
                                <li><span class="badge bg-primary me-2">Boys</span>Male participants</li>
                                <li><span class="badge bg-danger me-2">Girls</span>Female participants</li>
                                <li><span class="badge bg-success me-2">Open</span>Mixed gender events</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Class Groups:</h6>
                            <ul class="list-unstyled">
                                <li><span class="badge bg-secondary me-2">Open</span>Ages 19-20</li>
                                <li><span class="badge bg-secondary me-2">Class 1</span>Ages 17-18</li>
                                <li><span class="badge bg-secondary me-2">Class 2</span>Ages 15-16</li>
                                <li><span class="badge bg-secondary me-2">Class 3</span>Ages 13-14</li>
                                <li><span class="badge bg-secondary me-2">Class 4</span>Ages 11-12</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <i class="bi bi-lightning me-2"></i>Quick Actions
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <a asp-area="Admin" asp-controller="Developer" asp-action="Index" 
                               class="btn btn-outline-secondary w-100">
                                <i class="bi bi-arrow-left me-2"></i>Back to Developer Tools
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a asp-area="Admin" asp-controller="Events" asp-action="Index" 
                               class="btn btn-outline-primary w-100">
                                <i class="bi bi-calendar-event me-2"></i>View Events
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a asp-area="" asp-controller="Participant" asp-action="Register" 
                               class="btn btn-outline-success w-100">
                                <i class="bi bi-person-plus me-2"></i>Manual Registration
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a asp-area="Admin" asp-controller="Results" asp-action="Index" 
                               class="btn btn-outline-warning w-100">
                                <i class="bi bi-list-ol me-2"></i>View Results
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>